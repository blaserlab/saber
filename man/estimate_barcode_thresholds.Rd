% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/saber_constructor.R
\name{estimate_barcode_thresholds}
\alias{estimate_barcode_thresholds}
\title{Estimate empirical count and VAF thresholds from noise}
\usage{
estimate_barcode_thresholds(
  count_mat,
  depths = NULL,
  no_variant_pattern = "^no variant$",
  background = c("singletons", "all"),
  noise_quantile = 0.99
)
}
\arguments{
\item{count_mat}{Numeric matrix of variant counts (rows = variants,
columns = samples).}

\item{depths}{Optional numeric vector of per-sample depths (column sums).
If \code{NULL}, computed as \code{colSums(count_mat)} after excluding
rows matching \code{no_variant_pattern}.}

\item{no_variant_pattern}{Character scalar, regular expression matching
rows that represent "no variant" background to be excluded from noise
estimation.}

\item{background}{Character scalar specifying which cells to treat as
background when estimating thresholds. Either \code{"singletons"} (only
variants present in exactly one sample) or \code{"all"} (all non-zero
entries).}

\item{noise_quantile}{Numeric scalar in \eqn{(0, 1)} giving the quantile
of the empirical count and VAF distributions to treat as the upper bound
of noise. Values just above this quantile are used as thresholds.}
}
\value{
A list with elements:
\describe{
\item{count_thresh}{Integer count threshold for presence.}
\item{freq_thresh}{Numeric VAF threshold for presence.}
\item{noise_quantile}{The noise quantile used.}
\item{background}{The background mode used.}
\item{n_nonzero_used}{Number of non-zero observations used to estimate
thresholds.}
}
}
\description{
Estimate count and variant allele frequency (VAF) thresholds for defining
barcode presence based on the empirical distribution of low-prevalence
variants (noise) across a count matrix.
}
\details{
The function:
\enumerate{
\item Excludes rows matching \code{no_variant_pattern}.
\item Optionally restricts to "singleton" variants (present in exactly one
sample) when \code{background = "singletons"}.
\item Computes the specified \code{noise_quantile} of the empirical
non-zero counts and VAFs and sets \code{count_thresh} to one plus
the floored count quantile and \code{freq_thresh} to the VAF
quantile.
}
}
\keyword{internal}
